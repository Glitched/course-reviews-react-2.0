[{"type":"js","data":"/* Imports for global scope */\n\nMongoInternals = Package.mongo.MongoInternals;\nMongo = Package.mongo.Mongo;\nReactiveVar = Package['reactive-var'].ReactiveVar;\nTracker = Package.tracker.Tracker;\nDeps = Package.tracker.Deps;\nECMAScript = Package.ecmascript.ECMAScript;\nReactMeteorData = Package['react-meteor-data'].ReactMeteorData;\nSimpleSchema = Package['aldeed:simple-schema'].SimpleSchema;\nMongoObject = Package['aldeed:simple-schema'].MongoObject;\nHTTP = Package.http.HTTP;\nHTTPInternals = Package.http.HTTPInternals;\nMeteor = Package.meteor.Meteor;\nglobal = Package.meteor.global;\nmeteorEnv = Package.meteor.meteorEnv;\nWebApp = Package.webapp.WebApp;\nWebAppInternals = Package.webapp.WebAppInternals;\nmain = Package.webapp.main;\n_ = Package.underscore._;\nDDP = Package['ddp-client'].DDP;\nDDPServer = Package['ddp-server'].DDPServer;\nLaunchScreen = Package['launch-screen'].LaunchScreen;\nBlaze = Package.ui.Blaze;\nUI = Package.ui.UI;\nHandlebars = Package.ui.Handlebars;\nSpacebars = Package.spacebars.Spacebars;\nmeteorInstall = Package.modules.meteorInstall;\nprocess = Package.modules.process;\nmeteorBabelHelpers = Package['babel-runtime'].meteorBabelHelpers;\nPromise = Package.promise.Promise;\nAutoupdate = Package.autoupdate.Autoupdate;\nHTML = Package.htmljs.HTML;\nSymbol = Package['ecmascript-runtime-server'].Symbol;\nMap = Package['ecmascript-runtime-server'].Map;\nSet = Package['ecmascript-runtime-server'].Set;\n\n","servePath":"/packages/global-imports.js"},{"type":"js","data":"var require = meteorInstall({\"imports\":{\"api\":{\"classes.js\":function(require,exports,module){\n\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                             //\n// imports/api/classes.js                                                                                      //\n//                                                                                                             //\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                               //\nmodule.export({                                                                                                // 1\n\tClasses: function () {                                                                                        // 1\n\t\treturn Classes;                                                                                              // 1\n\t},                                                                                                            // 1\n\tSubjects: function () {                                                                                       // 1\n\t\treturn Subjects;                                                                                             // 1\n\t},                                                                                                            // 1\n\tReviews: function () {                                                                                        // 1\n\t\treturn Reviews;                                                                                              // 1\n\t}                                                                                                             // 1\n});                                                                                                            // 1\nvar Mongo = void 0;                                                                                            // 1\nmodule.watch(require(\"meteor/mongo\"), {                                                                        // 1\n\tMongo: function (v) {                                                                                         // 1\n\t\tMongo = v;                                                                                                   // 1\n\t}                                                                                                             // 1\n}, 0);                                                                                                         // 1\nvar HTTP = void 0;                                                                                             // 1\nmodule.watch(require(\"meteor/http\"), {                                                                         // 1\n\tHTTP: function (v) {                                                                                          // 1\n\t\tHTTP = v;                                                                                                    // 1\n\t}                                                                                                             // 1\n}, 1);                                                                                                         // 1\nvar check = void 0;                                                                                            // 1\nmodule.watch(require(\"meteor/check\"), {                                                                        // 1\n\tcheck: function (v) {                                                                                         // 1\n\t\tcheck = v;                                                                                                   // 1\n\t}                                                                                                             // 1\n}, 2);                                                                                                         // 1\nvar Classes = new Mongo.Collection('classes');                                                                 // 5\nClasses.schema = new SimpleSchema({                                                                            // 6\n\t_id: {                                                                                                        // 7\n\t\ttype: String                                                                                                 // 7\n\t},                                                                                                            // 7\n\tclassSub: {                                                                                                   // 8\n\t\ttype: String                                                                                                 // 8\n\t},                                                                                                            // 8\n\tclassNum: {                                                                                                   // 9\n\t\ttype: Number                                                                                                 // 9\n\t},                                                                                                            // 9\n\tclassTitle: {                                                                                                 // 10\n\t\ttype: String                                                                                                 // 10\n\t},                                                                                                            // 10\n\tclassAtten: {                                                                                                 // 11\n\t\ttype: Number                                                                                                 // 11\n\t},                                                                                                            // 11\n\tclassPrereq: {                                                                                                // 12\n\t\ttype: [String],                                                                                              // 12\n\t\toptional: true                                                                                               // 12\n\t},                                                                                                            // 12\n\tclassFull: {                                                                                                  // 13\n\t\ttype: String                                                                                                 // 13\n\t},                                                                                                            // 13\n\tclassSems: {                                                                                                  // 14\n\t\ttype: [String]                                                                                               // 14\n\t}                                                                                                             // 14\n});                                                                                                            // 6\nvar Subjects = new Mongo.Collection('subjects');                                                               // 17\nSubjects.schema = new SimpleSchema({                                                                           // 18\n\t_id: {                                                                                                        // 19\n\t\ttype: String                                                                                                 // 19\n\t},                                                                                                            // 19\n\tsubShort: {                                                                                                   // 20\n\t\ttype: String                                                                                                 // 20\n\t},                                                                                                            // 20\n\tsubFull: {                                                                                                    // 21\n\t\ttype: String                                                                                                 // 21\n\t}                                                                                                             // 21\n});                                                                                                            // 18\nvar Reviews = new Mongo.Collection('reviews');                                                                 // 24\nReviews.schema = new SimpleSchema({                                                                            // 25\n\t_id: {                                                                                                        // 26\n\t\ttype: String                                                                                                 // 26\n\t},                                                                                                            // 26\n\tuser: {                                                                                                       // 27\n\t\ttype: String                                                                                                 // 27\n\t},                                                                                                            // 27\n\ttext: {                                                                                                       // 28\n\t\ttype: String,                                                                                                // 28\n\t\toptional: true                                                                                               // 28\n\t},                                                                                                            // 28\n\tdifficulty: {                                                                                                 // 29\n\t\ttype: Number                                                                                                 // 29\n\t},                                                                                                            // 29\n\tquality: {                                                                                                    // 30\n\t\ttype: Number                                                                                                 // 30\n\t},                                                                                                            // 30\n\t\"class\": {                                                                                                    // 31\n\t\ttype: String                                                                                                 // 31\n\t},                                                                                                            // 31\n\t//ref to classId                                                                                              // 31\n\tgrade: {                                                                                                      // 32\n\t\ttype: Number                                                                                                 // 32\n\t},                                                                                                            // 32\n\tdate: {                                                                                                       // 33\n\t\ttype: Date                                                                                                   // 33\n\t},                                                                                                            // 33\n\tvisible: {                                                                                                    // 34\n\t\ttype: Number                                                                                                 // 34\n\t}                                                                                                             // 34\n}); // defines all methods that will be editing the database so that database changes occur only on the server\n                                                                                                               //\nMeteor.methods({                                                                                               // 38\n\t//insert a new review into the reviews database                                                               // 39\n\tinsert: function (review, classId) {                                                                          // 40\n\t\t//only insert if all necessary feilds are filled in                                                          // 41\n\t\tif (review.text != null && review.diff != null && review.quality != null && review.medGrade != null && classId != undefined && classId != null) {\n\t\t\t//ensure there are no illegal characters                                                                    // 43\n\t\t\tvar regex = new RegExp(/^(?=.*[A-Z0-9])[\\w:;.,!()\"'\\/$ ]+$/i);                                              // 44\n                                                                                                               //\n\t\t\tif (regex.test(review.text)) {                                                                              // 45\n\t\t\t\tReviews.insert({                                                                                           // 46\n\t\t\t\t\ttext: review.text,                                                                                        // 47\n\t\t\t\t\tdifficulty: review.diff,                                                                                  // 48\n\t\t\t\t\tquality: review.quality,                                                                                  // 49\n\t\t\t\t\t\"class\": classId,                                                                                         // 50\n\t\t\t\t\tgrade: review.medGrade,                                                                                   // 51\n\t\t\t\t\tdate: new Date(),                                                                                         // 52\n\t\t\t\t\tvisible: 0                                                                                                // 53\n\t\t\t\t});                                                                                                        // 46\n\t\t\t\treturn 1; //success                                                                                        // 55\n\t\t\t} else {                                                                                                    // 56\n\t\t\t\t\treturn 0; //fail                                                                                          // 57\n\t\t\t\t}                                                                                                          // 58\n\t\t} else {                                                                                                     // 59\n\t\t\t\treturn 0; //fail                                                                                           // 60\n\t\t\t}                                                                                                           // 61\n\t},                                                                                                            // 62\n\t//make the reveiw with this id visible, checking to make sure it has a real id                                // 63\n\tmakeVisible: function (review) {                                                                              // 64\n\t\tvar regex = new RegExp(/^(?=.*[A-Z0-9])/i);                                                                  // 65\n                                                                                                               //\n\t\tif (regex.test(review._id)) {                                                                                // 66\n\t\t\tReviews.update(review._id, {                                                                                // 67\n\t\t\t\t$set: {                                                                                                    // 67\n\t\t\t\t\tvisible: 1                                                                                                // 67\n\t\t\t\t}                                                                                                          // 67\n\t\t\t});                                                                                                         // 67\n\t\t\treturn 1;                                                                                                   // 68\n\t\t} else {                                                                                                     // 69\n\t\t\treturn 0;                                                                                                   // 70\n\t\t}                                                                                                            // 71\n\t},                                                                                                            // 72\n\t//remove the review with this id, checking to make sure the id is a real id                                   // 73\n\tremoveReview: function (review) {                                                                             // 74\n\t\tvar regex = new RegExp(/^(?=.*[A-Z0-9])/i);                                                                  // 75\n                                                                                                               //\n\t\tif (regex.test(review._id)) {                                                                                // 76\n\t\t\tReviews.remove({                                                                                            // 77\n\t\t\t\t_id: review._id                                                                                            // 77\n\t\t\t});                                                                                                         // 77\n\t\t\treturn 1;                                                                                                   // 78\n\t\t} else {                                                                                                     // 79\n\t\t\treturn 0;                                                                                                   // 80\n\t\t}                                                                                                            // 81\n\t},                                                                                                            // 82\n\t//update the database to add any new classes in the current semester if they don't already exist. To be called from the admin page once a semester.\n\taddNewSemester: function (initiate) {                                                                         // 84\n\t\tif (initiate && Meteor.isServer) {                                                                           // 85\n\t\t\t//return addAllCourses(findCurrSemester());                                                                 // 86\n\t\t\treturn addAllCourses(['FA15']);                                                                             // 87\n\t\t}                                                                                                            // 88\n\t},                                                                                                            // 89\n\t//get the course (as an object) with this id, checking to make sure the id is real                            // 90\n\tgetCourseById: function (courseId) {                                                                          // 91\n\t\t//console.log(courseId);                                                                                     // 92\n\t\tvar regex = new RegExp(/^(?=.*[A-Z0-9])/i);                                                                  // 93\n                                                                                                               //\n\t\tif (regex.test(courseId)) {                                                                                  // 95\n\t\t\tvar c = Classes.find({                                                                                      // 96\n\t\t\t\t_id: courseId                                                                                              // 96\n\t\t\t}).fetch()[0]; //console.log(c);                                                                            // 96\n                                                                                                               //\n\t\t\treturn c;                                                                                                   // 98\n\t\t}                                                                                                            // 99\n                                                                                                               //\n\t\treturn null;                                                                                                 // 100\n\t}                                                                                                             // 101\n}); //Code that runs only on the server                                                                        // 38\n                                                                                                               //\nif (Meteor.isServer) {                                                                                         // 105\n\tMeteor.startup(function () {                                                                                  // 106\n\t\t// code to run on server at startup                                                                          // 106\n\t\t//add indexes to collections for faster search                                                               // 107\n\t\tClasses._ensureIndex({                                                                                       // 108\n\t\t\t'classSub': 1                                                                                               // 109\n\t\t}, {                                                                                                         // 109\n\t\t\t'classNum': 1                                                                                               // 110\n\t\t}, {                                                                                                         // 110\n\t\t\t'classTitle': 1                                                                                             // 111\n\t\t}, {                                                                                                         // 111\n\t\t\t'_id': 1                                                                                                    // 112\n\t\t});                                                                                                          // 112\n                                                                                                               //\n\t\tSubjects._ensureIndex({                                                                                      // 114\n\t\t\t'subShort': 1                                                                                               // 115\n\t\t}, {                                                                                                         // 115\n\t\t\t'subFull': 1                                                                                                // 116\n\t\t});                                                                                                          // 116\n                                                                                                               //\n\t\tReviews._ensureIndex({                                                                                       // 118\n\t\t\t'class': 1                                                                                                  // 119\n\t\t}, {                                                                                                         // 119\n\t\t\t'difficulty': 1                                                                                             // 120\n\t\t}, {                                                                                                         // 120\n\t\t\t'quality': 1                                                                                                // 121\n\t\t}, {                                                                                                         // 121\n\t\t\t'grade': 1                                                                                                  // 122\n\t\t}, {                                                                                                         // 122\n\t\t\t'user': 1                                                                                                   // 123\n\t\t}, {                                                                                                         // 123\n\t\t\t'visible': 1                                                                                                // 124\n\t\t});                                                                                                          // 124\n\t}); //code that runs whenever needed                                                                          // 126\n\t//\"publish\" classes based on search query. Only published classes are visible to the client                   // 129\n                                                                                                               //\n\tMeteor.publish('classes', function () {                                                                       // 130\n\t\tfunction validClasses(searchString) {                                                                        // 130\n\t\t\tif (searchString != undefined && searchString != \"\") {                                                      // 131\n\t\t\t\tconsole.log(\"query entered:\", searchString);                                                               // 132\n\t\t\t\treturn Classes.find({                                                                                      // 133\n\t\t\t\t\t'$or': [{                                                                                                 // 133\n\t\t\t\t\t\t'classSub': {                                                                                            // 134\n\t\t\t\t\t\t\t'$regex': \".*\" + searchString + \".*\",                                                                   // 134\n\t\t\t\t\t\t\t'$options': '-i'                                                                                        // 134\n\t\t\t\t\t\t}                                                                                                        // 134\n\t\t\t\t\t}, {                                                                                                      // 134\n\t\t\t\t\t\t'classNum': {                                                                                            // 135\n\t\t\t\t\t\t\t'$regex': \".*\" + searchString + \".*\",                                                                   // 135\n\t\t\t\t\t\t\t'$options': '-i'                                                                                        // 135\n\t\t\t\t\t\t}                                                                                                        // 135\n\t\t\t\t\t}, {                                                                                                      // 135\n\t\t\t\t\t\t'classTitle': {                                                                                          // 136\n\t\t\t\t\t\t\t'$regex': \".*\" + searchString + \".*\",                                                                   // 136\n\t\t\t\t\t\t\t'$options': '-i'                                                                                        // 136\n\t\t\t\t\t\t}                                                                                                        // 136\n\t\t\t\t\t}, {                                                                                                      // 136\n\t\t\t\t\t\t'classFull': {                                                                                           // 137\n\t\t\t\t\t\t\t'$regex': \".*\" + searchString + \".*\",                                                                   // 137\n\t\t\t\t\t\t\t'$options': '-i'                                                                                        // 137\n\t\t\t\t\t\t}                                                                                                        // 137\n\t\t\t\t\t}]                                                                                                        // 137\n\t\t\t\t}, {                                                                                                       // 133\n\t\t\t\t\tlimit: 200                                                                                                // 140\n\t\t\t\t});                                                                                                        // 140\n\t\t\t} else {                                                                                                    // 141\n\t\t\t\tconsole.log(\"no search\");                                                                                  // 143\n\t\t\t\treturn Classes.find({}, {                                                                                  // 144\n\t\t\t\t\tlimit: 200                                                                                                // 145\n\t\t\t\t});                                                                                                        // 145\n\t\t\t}                                                                                                           // 146\n\t\t}                                                                                                            // 147\n                                                                                                               //\n\t\treturn validClasses;                                                                                         // 130\n\t}()); //\"publish\" reviews based on selected course and visibility requirements. Only published reviews are visible to the client\n                                                                                                               //\n\tMeteor.publish('reviews', function () {                                                                       // 150\n\t\tfunction validReviews(courseId, visiblity) {                                                                 // 150\n\t\t\tvar ret = null; //show valid reviews for this course                                                        // 151\n                                                                                                               //\n\t\t\tconsole.log('getting reviews');                                                                             // 153\n                                                                                                               //\n\t\t\tif (courseId != undefined && courseId != \"\" && visiblity == 1) {                                            // 154\n\t\t\t\tconsole.log('in 1');                                                                                       // 155\n\t\t\t\tret = Reviews.find({                                                                                       // 156\n\t\t\t\t\t\"class\": courseId,                                                                                        // 156\n\t\t\t\t\tvisible: 1                                                                                                // 156\n\t\t\t\t}, {                                                                                                       // 156\n\t\t\t\t\tlimit: 700                                                                                                // 156\n\t\t\t\t});                                                                                                        // 156\n\t\t\t} else if (courseId != undefined && courseId != \"\" && visiblity == 0) {                                     // 157\n\t\t\t\t//invalidated reviews for a class                                                                          // 157\n\t\t\t\tconsole.log('in 2');                                                                                       // 158\n\t\t\t\tret = Reviews.find({                                                                                       // 159\n\t\t\t\t\t\"class\": courseId,                                                                                        // 159\n\t\t\t\t\tvisible: 0                                                                                                // 159\n\t\t\t\t}, {                                                                                                       // 159\n\t\t\t\t\tlimit: 700                                                                                                // 160\n\t\t\t\t});                                                                                                        // 160\n\t\t\t} else if (visiblity == 0) {                                                                                // 161\n\t\t\t\t//all invalidated reviews                                                                                  // 161\n\t\t\t\tret = Reviews.find({                                                                                       // 162\n\t\t\t\t\tvisible: 0                                                                                                // 162\n\t\t\t\t}, {                                                                                                       // 162\n\t\t\t\t\tlimit: 700                                                                                                // 162\n\t\t\t\t});                                                                                                        // 162\n\t\t\t} else {                                                                                                    // 163\n\t\t\t\t//no reviews                                                                                               // 163\n\t\t\t\t//will always be empty because visible is 0 or 1. allows meteor to still send the ready flag when a new publication is sent\n\t\t\t\tret = Reviews.find({                                                                                       // 165\n\t\t\t\t\tvisible: 10                                                                                               // 165\n\t\t\t\t});                                                                                                        // 165\n\t\t\t}                                                                                                           // 166\n                                                                                                               //\n\t\t\treturn ret;                                                                                                 // 167\n\t\t}                                                                                                            // 168\n                                                                                                               //\n\t\treturn validReviews;                                                                                         // 150\n\t}()); // COMMENT THESE OUT AFTER THE FIRST METEOR BUILD!!                                                     // 150\n\t//Classes.remove({});                                                                                         // 171\n\t//Subjects.remove({});                                                                                        // 172\n\t//addAllCourses(findAllSemesters());                                                                          // 173\n} //Other helper functions used above                                                                          // 174\n// Adds all classes and subjects from Cornell's API between the selected semesters to the database.            // 178\n// Called when updating for a new semester and when initializing the database                                  // 179\n                                                                                                               //\n                                                                                                               //\nfunction addAllCourses(semesters) {                                                                            // 180\n\t// var semesters = [\"SP17\", \"SP16\", \"SP15\",\"FA17\", \"FA16\", \"FA15\"];                                           // 181\n\tfor (semester in meteorBabelHelpers.sanitizeForInObject(semesters)) {                                         // 182\n\t\t//get all classes in this semester                                                                           // 183\n\t\tvar result = HTTP.call(\"GET\", \"https://classes.cornell.edu/api/2.0/config/subjects.json?roster=\" + semesters[semester], {\n\t\t\ttimeout: 30000                                                                                              // 184\n\t\t});                                                                                                          // 184\n                                                                                                               //\n\t\tif (result.statusCode != 200) {                                                                              // 185\n\t\t\tconsole.log(\"error\");                                                                                       // 186\n\t\t} else {                                                                                                     // 187\n\t\t\tresponse = JSON.parse(result.content); //console.log(response);                                             // 188\n                                                                                                               //\n\t\t\tvar sub = response.data.subjects;                                                                           // 190\n                                                                                                               //\n\t\t\tfor (course in meteorBabelHelpers.sanitizeForInObject(sub)) {                                               // 191\n\t\t\t\tparent = sub[course]; //if subject doesn't exist add to Subjects collection                                // 192\n                                                                                                               //\n\t\t\t\tcheckSub = Subjects.find({                                                                                 // 194\n\t\t\t\t\t'subShort': parent.value.toLowerCase()                                                                    // 194\n\t\t\t\t}).fetch();                                                                                                // 194\n                                                                                                               //\n\t\t\t\tif (checkSub.length == 0) {                                                                                // 195\n\t\t\t\t\tconsole.log(\"new subject: \" + parent.value);                                                              // 196\n\t\t\t\t\tSubjects.insert({                                                                                         // 197\n\t\t\t\t\t\tsubShort: parent.value.toLowerCase(),                                                                    // 198\n\t\t\t\t\t\tsubFull: parent.descr                                                                                    // 199\n\t\t\t\t\t});                                                                                                       // 197\n\t\t\t\t} //for each subject, get all classes in that subject for this semester                                    // 201\n                                                                                                               //\n                                                                                                               //\n\t\t\t\tvar result2 = HTTP.call(\"GET\", \"https://classes.cornell.edu/api/2.0/search/classes.json?roster=\" + semesters[semester] + \"&subject=\" + parent.value, {\n\t\t\t\t\ttimeout: 30000                                                                                            // 204\n\t\t\t\t});                                                                                                        // 204\n                                                                                                               //\n\t\t\t\tif (result2.statusCode != 200) {                                                                           // 205\n\t\t\t\t\tconsole.log(\"error2\");                                                                                    // 206\n\t\t\t\t} else {                                                                                                   // 207\n\t\t\t\t\tresponse2 = JSON.parse(result2.content);                                                                  // 208\n\t\t\t\t\tcourses = response2.data.classes; //add each class to the Classes collection if it doesnt exist already   // 209\n                                                                                                               //\n\t\t\t\t\tfor (course in meteorBabelHelpers.sanitizeForInObject(courses)) {                                         // 212\n\t\t\t\t\t\ttry {                                                                                                    // 213\n\t\t\t\t\t\t\tvar check = Classes.find({                                                                              // 214\n\t\t\t\t\t\t\t\t'classSub': courses[course].subject.toLowerCase(),                                                     // 214\n\t\t\t\t\t\t\t\t'classNum': courses[course].catalogNbr                                                                 // 214\n\t\t\t\t\t\t\t}).fetch();                                                                                             // 214\n                                                                                                               //\n\t\t\t\t\t\t\tif (check.length == 0) {                                                                                // 215\n\t\t\t\t\t\t\t\tconsole.log(\"new class: \" + courses[course].subject + \" \" + courses[course].catalogNbr + \",\" + semesters[semester]); //insert new class with empty prereqs and reviews\n                                                                                                               //\n\t\t\t\t\t\t\t\tClasses.insert({                                                                                       // 218\n\t\t\t\t\t\t\t\t\tclassSub: courses[course].subject.toLowerCase(),                                                      // 219\n\t\t\t\t\t\t\t\t\tclassNum: courses[course].catalogNbr,                                                                 // 220\n\t\t\t\t\t\t\t\t\tclassTitle: courses[course].titleLong,                                                                // 221\n\t\t\t\t\t\t\t\t\tclassPrereq: [],                                                                                      // 222\n\t\t\t\t\t\t\t\t\tclassFull: courses[course].subject.toLowerCase() + \" \" + courses[course].catalogNbr + \" \" + courses[course].titleLong.toLowerCase(),\n\t\t\t\t\t\t\t\t\tclassSems: [semesters[semester]]                                                                      // 224\n\t\t\t\t\t\t\t\t});                                                                                                    // 218\n\t\t\t\t\t\t\t} else {                                                                                                // 226\n\t\t\t\t\t\t\t\tvar matchedCourse = check[0]; //only 1 should exist                                                    // 227\n                                                                                                               //\n\t\t\t\t\t\t\t\tvar oldSems = matchedCourse.classSems;                                                                 // 228\n                                                                                                               //\n\t\t\t\t\t\t\t\tif (oldSems.indexOf(semesters[semester]) == -1) {                                                      // 229\n\t\t\t\t\t\t\t\t\tconsole.log(\"update class \" + courses[course].subject + \" \" + courses[course].catalogNbr + \",\" + semesters[semester]);\n\t\t\t\t\t\t\t\t\toldSems.push(semesters[semester]); //add this semester to the list                                    // 231\n                                                                                                               //\n\t\t\t\t\t\t\t\t\tClasses.update({                                                                                      // 232\n\t\t\t\t\t\t\t\t\t\t_id: matchedCourse._id                                                                               // 232\n\t\t\t\t\t\t\t\t\t}, {                                                                                                  // 232\n\t\t\t\t\t\t\t\t\t\t$set: {                                                                                              // 232\n\t\t\t\t\t\t\t\t\t\t\tclassSems: oldSems                                                                                  // 232\n\t\t\t\t\t\t\t\t\t\t}                                                                                                    // 232\n\t\t\t\t\t\t\t\t\t});                                                                                                   // 232\n\t\t\t\t\t\t\t\t}                                                                                                      // 233\n\t\t\t\t\t\t\t}                                                                                                       // 234\n\t\t\t\t\t\t} catch (error) {                                                                                        // 235\n\t\t\t\t\t\t\tconsole.log(course);                                                                                    // 236\n\t\t\t\t\t\t}                                                                                                        // 237\n\t\t\t\t\t}                                                                                                         // 238\n\t\t\t\t}                                                                                                          // 239\n\t\t\t}                                                                                                           // 240\n\t\t}                                                                                                            // 241\n\t}                                                                                                             // 242\n} //returns an array of the current semester, to be given to the addAllCourses function                        // 243\n                                                                                                               //\n                                                                                                               //\nfunction findCurrSemester() {                                                                                  // 246\n\tvar response = HTTP.call(\"GET\", \"https://classes.cornell.edu/api/2.0/config/rosters.json\", {                  // 247\n\t\ttimeout: 30000                                                                                               // 247\n\t});                                                                                                           // 247\n                                                                                                               //\n\tif (response.statusCode != 200) {                                                                             // 248\n\t\tconsole.log(\"error\");                                                                                        // 249\n\t} else {                                                                                                      // 250\n\t\tresponse = JSON.parse(response.content);                                                                     // 251\n\t\tallSemesters = response.data.rosters;                                                                        // 252\n\t\tthisSem = allSemesters[allSemesters.length - 1].slug;                                                        // 253\n\t\treturn [thisSem];                                                                                            // 254\n\t}                                                                                                             // 255\n} //returns an array of all current semesters, to be given to the addAllCourses function                       // 256\n                                                                                                               //\n                                                                                                               //\nfunction findAllSemesters() {                                                                                  // 259\n\tvar response = HTTP.call(\"GET\", \"https://classes.cornell.edu/api/2.0/config/rosters.json\", {                  // 260\n\t\ttimeout: 30000                                                                                               // 260\n\t});                                                                                                           // 260\n                                                                                                               //\n\tif (response.statusCode != 200) {                                                                             // 261\n\t\tconsole.log(\"error\");                                                                                        // 262\n\t} else {                                                                                                      // 263\n\t\tresponse = JSON.parse(response.content);                                                                     // 264\n\t\tallSemesters = response.data.rosters;                                                                        // 265\n\t\tvar allSemestersArray = allSemesters.map(function (semesterObject) {                                         // 266\n\t\t\treturn semesterObject.slug;                                                                                 // 267\n\t\t});                                                                                                          // 268\n\t\tconsole.log(allSemestersArray);                                                                              // 269\n\t\treturn allSemestersArray;                                                                                    // 270\n\t}                                                                                                             // 271\n}                                                                                                              // 272\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n}}},\"server\":{\"main.js\":function(require,exports,module){\n\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                             //\n// server/main.js                                                                                              //\n//                                                                                                             //\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                               //\nvar Meteor = void 0;                                                                                           // 1\nmodule.watch(require(\"meteor/meteor\"), {                                                                       // 1\n  Meteor: function (v) {                                                                                       // 1\n    Meteor = v;                                                                                                // 1\n  }                                                                                                            // 1\n}, 0);                                                                                                         // 1\nmodule.watch(require(\"../imports/api/classes.js\"));                                                            // 1\nMeteor.startup(function () {// code to run on server at startup                                                // 4\n});                                                                                                            // 6\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n}}},{\n  \"extensions\": [\n    \".js\",\n    \".json\",\n    \".jsx\"\n  ]\n});\nrequire(\"./server/main.js\");","servePath":"/app.js","sourceMap":{"version":3,"sources":["imports/api/classes.js","server/main.js"],"names":["module","export","Classes","Subjects","Reviews","Mongo","watch","require","v","HTTP","check","Collection","schema","SimpleSchema","_id","type","String","classSub","classNum","Number","classTitle","classAtten","classPrereq","optional","classFull","classSems","subShort","subFull","user","text","difficulty","quality","grade","date","Date","visible","Meteor","methods","insert","review","classId","diff","medGrade","undefined","regex","RegExp","test","makeVisible","update","$set","removeReview","remove","addNewSemester","initiate","isServer","addAllCourses","getCourseById","courseId","c","find","fetch","startup","_ensureIndex","publish","validClasses","searchString","console","log","limit","validReviews","visiblity","ret","semesters","semester","result","call","timeout","statusCode","response","JSON","parse","content","sub","data","subjects","course","parent","checkSub","value","toLowerCase","length","descr","result2","response2","courses","classes","subject","catalogNbr","titleLong","matchedCourse","oldSems","indexOf","push","error","findCurrSemester","allSemesters","rosters","thisSem","slug","findAllSemesters","allSemestersArray","map","semesterObject"],"mappings":"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","file":"/app.js","sourcesContent":["import { Mongo } from 'meteor/mongo';\nimport { HTTP } from 'meteor/http';\nimport { check } from 'meteor/check';\n\nexport const Classes = new Mongo.Collection('classes');\nClasses.schema = new SimpleSchema({\n  _id: {type: String},\n  classSub: {type: String},\n  classNum: {type: Number},\n  classTitle: {type: String},\n  classAtten: {type: Number},\n  classPrereq : { type: [String] ,optional: true},\n  classFull: {type: String},\n  classSems: {type: [String]}\n});\n\nexport const Subjects = new Mongo.Collection('subjects');\nSubjects.schema = new SimpleSchema({\n\t_id: {type: String},\n\tsubShort : {type: String},\n\tsubFull: {type: String}\n});\n\nexport const Reviews = new Mongo.Collection('reviews');\nReviews.schema = new SimpleSchema({\n\t_id: {type: String},\n\tuser: {type: String},\n\ttext: {type: String,optional: true},\n\tdifficulty: {type: Number},\n\tquality: {type: Number},\n \tclass: {type: String}, //ref to classId\n \tgrade: {type: Number},\n \tdate: {type: Date},\n \tvisible: {type: Number}\n});\n\n// defines all methods that will be editing the database so that database changes occur only on the server\nMeteor.methods({\n\t//insert a new review into the reviews database\n\tinsert: function(review, classId) {\n\t\t//only insert if all necessary feilds are filled in\n\t\tif (review.text != null && review.diff != null && review.quality != null && review.medGrade != null && classId != undefined && classId != null) {\n\t\t\t//ensure there are no illegal characters\n\t\t\tvar regex = new RegExp(/^(?=.*[A-Z0-9])[\\w:;.,!()\"'\\/$ ]+$/i)\n\t\t\tif (regex.test(review.text)) {\n\t\t\t  \tReviews.insert({\n\t\t\t\t    text: review.text,\n\t\t\t\t    difficulty: review.diff,\n\t\t\t\t    quality: review.quality,\n\t\t\t\t    class: classId,\n\t\t\t\t    grade: review.medGrade,\n\t\t\t\t    date: new Date(),\n\t\t\t\t    visible: 0\n\t\t\t\t})\n\t\t\t\treturn 1 //success\n\t\t\t} else {\n\t\t\t\treturn 0 //fail\n\t\t\t}\n\t\t} else {\n\t\t\treturn 0 //fail\n\t\t}\n\t},\n\t//make the reveiw with this id visible, checking to make sure it has a real id\n\tmakeVisible: function (review) {\n\t\tvar regex = new RegExp(/^(?=.*[A-Z0-9])/i)\n\t\tif (regex.test(review._id)) {\n   \t\t\tReviews.update(review._id, {$set: { visible: 1} })\n   \t\t\treturn 1\n   \t\t} else {\n   \t\t\treturn 0\n   \t\t}\n \t},\n \t//remove the review with this id, checking to make sure the id is a real id\n \tremoveReview: function(review) {\n \t\tvar regex = new RegExp(/^(?=.*[A-Z0-9])/i)\n\t\tif (regex.test(review._id)) {\n   \t\tReviews.remove({ _id: review._id})\n   \t\treturn 1\n   \t} else {\n   \t\treturn 0\n   \t}\n\t},\n\t//update the database to add any new classes in the current semester if they don't already exist. To be called from the admin page once a semester.\n\taddNewSemester: function(initiate) {\n\t\tif (initiate && Meteor.isServer) {\n\t\t\t//return addAllCourses(findCurrSemester());\n\t\t\treturn addAllCourses(['FA15']);\n\t\t}\n  },\n  //get the course (as an object) with this id, checking to make sure the id is real\n  getCourseById: function(courseId) {\n    //console.log(courseId);\n    var regex = new RegExp(/^(?=.*[A-Z0-9])/i)\n\n    if (regex.test(courseId)) {\n      var c = Classes.find({_id: courseId}).fetch()[0];\n      //console.log(c);\n   \t\treturn c;\n   \t}\n    return null\n  }\n});\n\n//Code that runs only on the server\nif (Meteor.isServer) {\n    Meteor.startup(() => { // code to run on server at startup\n\t  //add indexes to collections for faster search\n\t  Classes._ensureIndex(\n\t        { 'classSub' : 1 },\n\t        { 'classNum' : 1 },\n\t        { 'classTitle' : 1 },\n          { '_id' : 1}\n\t    );\n\t  Subjects._ensureIndex(\n\t  \t\t{ 'subShort' : 1 },\n\t        { 'subFull' : 1 }\n\t  \t);\n\t  Reviews._ensureIndex(\n\t    \t{ 'class' : 1},\n\t    \t{ 'difficulty' : 1 },\n\t    \t{ 'quality' : 1 },\n\t    \t{ 'grade' : 1 },\n\t    \t{ 'user' : 1 },\n\t    \t{ 'visible' : 1 }\n\t  \t);\n\t  });\n\n    //code that runs whenever needed\n    //\"publish\" classes based on search query. Only published classes are visible to the client\n    Meteor.publish('classes', function validClasses(searchString) {\n\t  \tif (searchString != undefined && searchString != \"\") {\n\t  \t\tconsole.log(\"query entered:\", searchString);\n\t  \t\treturn Classes.find({'$or' : [\n\t\t\t  { 'classSub':{ '$regex' : `.*${searchString}.*`, '$options' : '-i' }},\n\t\t\t  { 'classNum':{ '$regex' : `.*${searchString}.*`, '$options' : '-i' } },\n\t\t\t  { 'classTitle':{ '$regex' : `.*${searchString}.*`, '$options' : '-i' }},\n\t\t\t  { 'classFull':{ '$regex' : `.*${searchString}.*`, '$options' : '-i' }}]\n\n\t\t\t},\n\t\t\t{limit: 200});\n\t  \t}\n\t  \telse {\n        console.log(\"no search\");\n\t  \t\treturn Classes.find({},\n\t  \t\t{limit: 200});\n\t  \t}\n  \t});\n\n    //\"publish\" reviews based on selected course and visibility requirements. Only published reviews are visible to the client\n\tMeteor.publish('reviews', function validReviews(courseId, visiblity) {\n\t  \tvar ret = null\n\t  \t//show valid reviews for this course\n      console.log('getting reviews');\n\t  \tif (courseId != undefined && courseId != \"\" && visiblity == 1) {\n        console.log('in 1');\n\t  \t\tret =  Reviews.find({class : courseId, visible : 1}, {limit: 700});\n\t  \t} else if (courseId != undefined && courseId != \"\" && visiblity == 0) { //invalidated reviews for a class\n        console.log('in 2');\n        ret =  Reviews.find({class : courseId, visible : 0},\n\t\t\t{limit: 700});\n\t  \t} else if (visiblity == 0) { //all invalidated reviews\n\t  \t\tret =  Reviews.find({visible : 0}, {limit: 700});\n\t  \t} else { //no reviews\n\t  \t\t//will always be empty because visible is 0 or 1. allows meteor to still send the ready flag when a new publication is sent\n\t  \t\tret = Reviews.find({visible : 10});\n\t  \t}\n\t  \treturn ret\n  \t});\n\n  \t// COMMENT THESE OUT AFTER THE FIRST METEOR BUILD!!\n\t//Classes.remove({});\n\t//Subjects.remove({});\n\t//addAllCourses(findAllSemesters());\n}\n\n//Other helper functions used above\n\n// Adds all classes and subjects from Cornell's API between the selected semesters to the database.\n// Called when updating for a new semester and when initializing the database\nfunction addAllCourses(semesters) {\n    // var semesters = [\"SP17\", \"SP16\", \"SP15\",\"FA17\", \"FA16\", \"FA15\"];\n\tfor (semester in semesters) {\n\t\t//get all classes in this semester\n\t    var result = HTTP.call(\"GET\", \"https://classes.cornell.edu/api/2.0/config/subjects.json?roster=\" + semesters[semester], {timeout: 30000});\n\t    if (result.statusCode != 200) {\n\t      console.log(\"error\");\n\t    } else {\n\t\t  \tresponse = JSON.parse(result.content);\n\t\t  \t//console.log(response);\n\t\t\tvar sub = response.data.subjects;\n\t\t\tfor (course in sub) {\n\t\t\t    parent = sub[course];\n\t\t\t    //if subject doesn't exist add to Subjects collection\n\t\t\t    checkSub = Subjects.find({'subShort' : (parent.value).toLowerCase()}).fetch();\n\t\t\t    if (checkSub.length == 0) {\n\t\t\t     \tconsole.log(\"new subject: \" + parent.value);\n\t\t\t        Subjects.insert({\n\t\t\t        \tsubShort : (parent.value).toLowerCase(),\n\t\t\t        \tsubFull : parent.descr\n\t\t\t        });\n\t\t\t    }\n\n\t\t\t    //for each subject, get all classes in that subject for this semester\n\t\t\t    var result2 = HTTP.call(\"GET\", \"https://classes.cornell.edu/api/2.0/search/classes.json?roster=\" + semesters[semester] + \"&subject=\"+ parent.value, {timeout: 30000});\n\t\t\t    if (result2.statusCode != 200) {\n\t\t\t    \tconsole.log(\"error2\");\n\t\t\t    } else {\n\t\t\t    \tresponse2 = JSON.parse(result2.content);\n\t\t\t\t    courses = response2.data.classes;\n\n\t\t\t\t    //add each class to the Classes collection if it doesnt exist already\n\t\t\t\t    for (course in courses) {\n\t\t\t\t    \ttry {\n\t\t\t\t\t        var check = Classes.find({'classSub' : (courses[course].subject).toLowerCase(), 'classNum' : courses[course].catalogNbr}).fetch();\n\t\t\t\t\t        if (check.length == 0) {\n\t\t\t\t\t            console.log(\"new class: \" + courses[course].subject + \" \" + courses[course].catalogNbr + \",\" + semesters[semester]);\n\t\t\t\t\t        \t//insert new class with empty prereqs and reviews\n\t\t\t\t\t        \tClasses.insert({\n\t\t\t\t\t          \t\tclassSub : (courses[course].subject).toLowerCase(),\n\t\t\t\t\t          \t\tclassNum : courses[course].catalogNbr,\n\t\t\t\t\t          \t\tclassTitle : courses[course].titleLong,\n\t\t\t\t\t          \t\tclassPrereq : [],\n\t\t\t\t\t          \t\tclassFull: (courses[course].subject).toLowerCase() + \" \" + courses[course].catalogNbr +\" \" + courses[course].titleLong.toLowerCase(),\n\t\t\t\t\t          \t\tclassSems: [semesters[semester]]\n\t\t\t\t\t       \t\t});\n\t\t\t\t\t     \t} else {\n\t\t\t\t\t     \t\tvar matchedCourse = check[0] //only 1 should exist\n\t\t\t\t\t     \t\tvar oldSems = matchedCourse.classSems;\n\t\t\t\t\t        \tif (oldSems.indexOf(semesters[semester]) == -1) {\n\t\t\t\t\t        \t\tconsole.log(\"update class \" + courses[course].subject + \" \" + courses[course].catalogNbr + \",\" + semesters[semester]);\n\t\t\t\t\t\t        \toldSems.push(semesters[semester]) //add this semester to the list\n\t\t\t\t\t\t        \tClasses.update({_id: matchedCourse._id}, {$set: {classSems: oldSems}})\n\t\t\t\t\t\t        }\n\t\t\t\t\t      \t}\n\t\t\t\t\t    } catch(error){\n\t\t\t\t\t    \tconsole.log(course);\n\t\t\t\t\t    }\n\t\t\t\t    }\n\t\t\t    }\n\t\t\t}\n\t\t}\n\t}\n}\n\n//returns an array of the current semester, to be given to the addAllCourses function\nfunction findCurrSemester()  {\n\tvar response = HTTP.call(\"GET\", \"https://classes.cornell.edu/api/2.0/config/rosters.json\", {timeout: 30000});\n\tif (response.statusCode != 200) {\n      console.log(\"error\");\n    } else {\n\t  \tresponse = JSON.parse(response.content);\n\t\tallSemesters = response.data.rosters;\n\t\tthisSem = allSemesters[allSemesters.length - 1].slug;\n\t\treturn [thisSem];\n\t}\n}\n\n//returns an array of all current semesters, to be given to the addAllCourses function\nfunction findAllSemesters() {\n\tvar response = HTTP.call(\"GET\", \"https://classes.cornell.edu/api/2.0/config/rosters.json\", {timeout: 30000});\n\tif (response.statusCode != 200) {\n      console.log(\"error\");\n    } else {\n\t  \tresponse = JSON.parse(response.content);\n\t\tallSemesters = response.data.rosters;\n\t\tvar allSemestersArray = allSemesters.map(function(semesterObject) {\n\t\t\treturn semesterObject.slug;\n\t\t})\n\t\tconsole.log(allSemestersArray)\n\t\treturn allSemestersArray\n\t}\n}\n","import { Meteor } from 'meteor/meteor';\nimport '../imports/api/classes.js';\n\nMeteor.startup(() => {\n  // code to run on server at startup\n});\n"]}}]