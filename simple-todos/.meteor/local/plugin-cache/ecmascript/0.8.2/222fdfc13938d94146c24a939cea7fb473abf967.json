{"metadata":{"usedHelpers":[],"marked":[],"modules":{"imports":[{"source":"meteor/mongo","imported":["Mongo"],"specifiers":[{"kind":"named","imported":"Mongo","local":"Mongo"}]},{"source":"meteor/http","imported":["HTTP"],"specifiers":[{"kind":"named","imported":"HTTP","local":"HTTP"}]},{"source":"meteor/check","imported":["check"],"specifiers":[{"kind":"named","imported":"check","local":"check"}]}],"exports":{"exported":["Classes","Subjects","Reviews"],"specifiers":[{"kind":"local","local":"Classes","exported":"Classes"},{"kind":"local","local":"Subjects","exported":"Subjects"},{"kind":"local","local":"Reviews","exported":"Reviews"}]}}},"options":{"filename":"imports/api/classes.js","filenameRelative":"imports/api/classes.js","env":{"development":{"plugins":[]}},"retainLines":false,"highlightCode":true,"suppressDeprecationMessages":false,"presets":[],"plugins":[[[],{"generateLetDeclarations":true,"enforceStrictMode":false}],[[],null],[[],{"polyfill":false}],[[],null],[[],null],[[],null],[[],{"allowTopLevelThis":true,"strict":false,"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":true}],[[],{"loose":true}],[[],null],[[],{"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null]],"ignore":[],"code":true,"metadata":true,"ast":true,"comments":true,"compact":false,"minified":false,"sourceMap":true,"sourceMaps":true,"sourceMapTarget":"imports/api/classes.js.map","sourceFileName":"imports/api/classes.js","babelrc":false,"sourceType":"module","moduleIds":false,"passPerPreset":false,"parserOpts":false,"generatorOpts":false,"basename":"classes"},"ignored":false,"code":"module.export({\n\tClasses: function () {\n\t\treturn Classes;\n\t},\n\tSubjects: function () {\n\t\treturn Subjects;\n\t},\n\tReviews: function () {\n\t\treturn Reviews;\n\t}\n});\nvar Mongo = void 0;\nmodule.watch(require(\"meteor/mongo\"), {\n\tMongo: function (v) {\n\t\tMongo = v;\n\t}\n}, 0);\nvar HTTP = void 0;\nmodule.watch(require(\"meteor/http\"), {\n\tHTTP: function (v) {\n\t\tHTTP = v;\n\t}\n}, 1);\nvar check = void 0;\nmodule.watch(require(\"meteor/check\"), {\n\tcheck: function (v) {\n\t\tcheck = v;\n\t}\n}, 2);\nvar Classes = new Mongo.Collection('classes');\nClasses.schema = new SimpleSchema({\n\t_id: {\n\t\ttype: String\n\t},\n\tclassSub: {\n\t\ttype: String\n\t},\n\tclassNum: {\n\t\ttype: Number\n\t},\n\tclassTitle: {\n\t\ttype: String\n\t},\n\tclassAtten: {\n\t\ttype: Number\n\t},\n\tclassPrereq: {\n\t\ttype: [String],\n\t\toptional: true\n\t},\n\tclassFull: {\n\t\ttype: String\n\t},\n\tclassSems: {\n\t\ttype: [String]\n\t}\n});\nvar Subjects = new Mongo.Collection('subjects');\nSubjects.schema = new SimpleSchema({\n\t_id: {\n\t\ttype: String\n\t},\n\tsubShort: {\n\t\ttype: String\n\t},\n\tsubFull: {\n\t\ttype: String\n\t}\n});\nvar Reviews = new Mongo.Collection('reviews');\nReviews.schema = new SimpleSchema({\n\t_id: {\n\t\ttype: String\n\t},\n\tuser: {\n\t\ttype: String\n\t},\n\ttext: {\n\t\ttype: String,\n\t\toptional: true\n\t},\n\tdifficulty: {\n\t\ttype: Number\n\t},\n\tquality: {\n\t\ttype: Number\n\t},\n\t\"class\": {\n\t\ttype: String\n\t},\n\t//ref to classId\n\tgrade: {\n\t\ttype: Number\n\t},\n\tdate: {\n\t\ttype: Date\n\t},\n\tvisible: {\n\t\ttype: Number\n\t}\n}); // defines all methods that will be editing the database so that database changes occur only on the server\n\nMeteor.methods({\n\t//insert a new review into the reviews database\n\tinsert: function (review, classId) {\n\t\t//only insert if all necessary feilds are filled in\n\t\tif (review.text != null && review.diff != null && review.quality != null && review.medGrade != null && classId != undefined && classId != null) {\n\t\t\t//ensure there are no illegal characters\n\t\t\tvar regex = new RegExp(/^(?=.*[A-Z0-9])[\\w:;.,!()\"'\\/$ ]+$/i);\n\n\t\t\tif (regex.test(review.text)) {\n\t\t\t\tReviews.insert({\n\t\t\t\t\ttext: review.text,\n\t\t\t\t\tdifficulty: review.diff,\n\t\t\t\t\tquality: review.quality,\n\t\t\t\t\t\"class\": classId,\n\t\t\t\t\tgrade: review.medGrade,\n\t\t\t\t\tdate: new Date(),\n\t\t\t\t\tvisible: 0\n\t\t\t\t});\n\t\t\t\treturn 1; //success\n\t\t\t} else {\n\t\t\t\t\treturn 0; //fail\n\t\t\t\t}\n\t\t} else {\n\t\t\t\treturn 0; //fail\n\t\t\t}\n\t},\n\t//make the reveiw with this id visible, checking to make sure it has a real id\n\tmakeVisible: function (review) {\n\t\tvar regex = new RegExp(/^(?=.*[A-Z0-9])/i);\n\n\t\tif (regex.test(review._id)) {\n\t\t\tReviews.update(review._id, {\n\t\t\t\t$set: {\n\t\t\t\t\tvisible: 1\n\t\t\t\t}\n\t\t\t});\n\t\t\treturn 1;\n\t\t} else {\n\t\t\treturn 0;\n\t\t}\n\t},\n\t//remove the review with this id, checking to make sure the id is a real id\n\tremoveReview: function (review) {\n\t\tvar regex = new RegExp(/^(?=.*[A-Z0-9])/i);\n\n\t\tif (regex.test(review._id)) {\n\t\t\tReviews.remove({\n\t\t\t\t_id: review._id\n\t\t\t});\n\t\t\treturn 1;\n\t\t} else {\n\t\t\treturn 0;\n\t\t}\n\t},\n\t//update the database to add any new classes in the current semester if they don't already exist. To be called from the admin page once a semester.\n\taddNewSemester: function (initiate) {\n\t\tif (initiate && Meteor.isServer) {\n\t\t\t//return addAllCourses(findCurrSemester());\n\t\t\treturn addAllCourses(['FA15']);\n\t\t}\n\t},\n\t//get the course (as an object) with this id, checking to make sure the id is real\n\tgetCourseById: function (courseId) {\n\t\tconsole.log(courseId);\n\t\tvar regex = new RegExp(/^(?=.*[A-Z0-9])/i);\n\n\t\tif (regex.test(courseId)) {\n\t\t\tvar c = Classes.find({\n\t\t\t\t_id: courseId\n\t\t\t}).fetch()[0]; //console.log(c);\n\n\t\t\treturn c;\n\t\t}\n\n\t\treturn null;\n\t}\n}); //Code that runs only on the server\n\nif (Meteor.isServer) {\n\tMeteor.startup(function () {\n\t\t// code to run on server at startup\n\t\t//add indexes to collections for faster search\n\t\tClasses._ensureIndex({\n\t\t\t'classSub': 1\n\t\t}, {\n\t\t\t'classNum': 1\n\t\t}, {\n\t\t\t'classTitle': 1\n\t\t}, {\n\t\t\t'_id': 1\n\t\t});\n\n\t\tSubjects._ensureIndex({\n\t\t\t'subShort': 1\n\t\t}, {\n\t\t\t'subFull': 1\n\t\t});\n\n\t\tReviews._ensureIndex({\n\t\t\t'class': 1\n\t\t}, {\n\t\t\t'difficulty': 1\n\t\t}, {\n\t\t\t'quality': 1\n\t\t}, {\n\t\t\t'grade': 1\n\t\t}, {\n\t\t\t'user': 1\n\t\t}, {\n\t\t\t'visible': 1\n\t\t});\n\t}); //code that runs whenever needed\n\t//\"publish\" classes based on search query. Only published classes are visible to the client\n\n\tMeteor.publish('classes', function () {\n\t\tfunction validClasses(searchString) {\n\t\t\tif (searchString != undefined && searchString != \"\") {\n\t\t\t\tconsole.log(\"query entered:\", searchString);\n\t\t\t\treturn Classes.find({\n\t\t\t\t\t'$or': [{\n\t\t\t\t\t\t'classSub': {\n\t\t\t\t\t\t\t'$regex': \".*\" + searchString + \".*\",\n\t\t\t\t\t\t\t'$options': '-i'\n\t\t\t\t\t\t}\n\t\t\t\t\t}, {\n\t\t\t\t\t\t'classNum': {\n\t\t\t\t\t\t\t'$regex': \".*\" + searchString + \".*\",\n\t\t\t\t\t\t\t'$options': '-i'\n\t\t\t\t\t\t}\n\t\t\t\t\t}, {\n\t\t\t\t\t\t'classTitle': {\n\t\t\t\t\t\t\t'$regex': \".*\" + searchString + \".*\",\n\t\t\t\t\t\t\t'$options': '-i'\n\t\t\t\t\t\t}\n\t\t\t\t\t}, {\n\t\t\t\t\t\t'classFull': {\n\t\t\t\t\t\t\t'$regex': \".*\" + searchString + \".*\",\n\t\t\t\t\t\t\t'$options': '-i'\n\t\t\t\t\t\t}\n\t\t\t\t\t}]\n\t\t\t\t}, {\n\t\t\t\t\tlimit: 200\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tconsole.log(\"no search\");\n\t\t\t\treturn Classes.find({}, {\n\t\t\t\t\tlimit: 200\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\treturn validClasses;\n\t}()); //\"publish\" reviews based on selected course and visibility requirements. Only published reviews are visible to the client\n\n\tMeteor.publish('reviews', function () {\n\t\tfunction validReviews(courseId, visiblity) {\n\t\t\tvar ret = null; //show valid reviews for this course\n\n\t\t\tconsole.log('getting reviews');\n\n\t\t\tif (courseId != undefined && courseId != \"\" && visiblity == 1) {\n\t\t\t\tconsole.log('in 1');\n\t\t\t\tret = Reviews.find({\n\t\t\t\t\t\"class\": courseId,\n\t\t\t\t\tvisible: 1\n\t\t\t\t}, {\n\t\t\t\t\tlimit: 700\n\t\t\t\t});\n\t\t\t} else if (courseId != undefined && courseId != \"\" && visiblity == 0) {\n\t\t\t\t//invalidated reviews for a class\n\t\t\t\tconsole.log('in 2');\n\t\t\t\tret = Reviews.find({\n\t\t\t\t\t\"class\": courseId,\n\t\t\t\t\tvisible: 0\n\t\t\t\t}, {\n\t\t\t\t\tlimit: 700\n\t\t\t\t});\n\t\t\t} else if (visiblity == 0) {\n\t\t\t\t//all invalidated reviews\n\t\t\t\tret = Reviews.find({\n\t\t\t\t\tvisible: 0\n\t\t\t\t}, {\n\t\t\t\t\tlimit: 700\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\t//no reviews\n\t\t\t\t//will always be empty because visible is 0 or 1. allows meteor to still send the ready flag when a new publication is sent\n\t\t\t\tret = Reviews.find({\n\t\t\t\t\tvisible: 10\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn ret;\n\t\t}\n\n\t\treturn validReviews;\n\t}()); // COMMENT THESE OUT AFTER THE FIRST METEOR BUILD!!\n\t//Classes.remove({});\n\t//Subjects.remove({});\n\t//addAllCourses(findAllSemesters());\n} //Other helper functions used above\n// Adds all classes and subjects from Cornell's API between the selected semesters to the database.\n// Called when updating for a new semester and when initializing the database\n\n\nfunction addAllCourses(semesters) {\n\t// var semesters = [\"SP17\", \"SP16\", \"SP15\",\"FA17\", \"FA16\", \"FA15\"];\n\tfor (semester in meteorBabelHelpers.sanitizeForInObject(semesters)) {\n\t\t//get all classes in this semester\n\t\tvar result = HTTP.call(\"GET\", \"https://classes.cornell.edu/api/2.0/config/subjects.json?roster=\" + semesters[semester], {\n\t\t\ttimeout: 30000\n\t\t});\n\n\t\tif (result.statusCode != 200) {\n\t\t\tconsole.log(\"error\");\n\t\t} else {\n\t\t\tresponse = JSON.parse(result.content); //console.log(response);\n\n\t\t\tvar sub = response.data.subjects;\n\n\t\t\tfor (course in meteorBabelHelpers.sanitizeForInObject(sub)) {\n\t\t\t\tparent = sub[course]; //if subject doesn't exist add to Subjects collection\n\n\t\t\t\tcheckSub = Subjects.find({\n\t\t\t\t\t'subShort': parent.value.toLowerCase()\n\t\t\t\t}).fetch();\n\n\t\t\t\tif (checkSub.length == 0) {\n\t\t\t\t\tconsole.log(\"new subject: \" + parent.value);\n\t\t\t\t\tSubjects.insert({\n\t\t\t\t\t\tsubShort: parent.value.toLowerCase(),\n\t\t\t\t\t\tsubFull: parent.descr\n\t\t\t\t\t});\n\t\t\t\t} //for each subject, get all classes in that subject for this semester\n\n\n\t\t\t\tvar result2 = HTTP.call(\"GET\", \"https://classes.cornell.edu/api/2.0/search/classes.json?roster=\" + semesters[semester] + \"&subject=\" + parent.value, {\n\t\t\t\t\ttimeout: 30000\n\t\t\t\t});\n\n\t\t\t\tif (result2.statusCode != 200) {\n\t\t\t\t\tconsole.log(\"error2\");\n\t\t\t\t} else {\n\t\t\t\t\tresponse2 = JSON.parse(result2.content);\n\t\t\t\t\tcourses = response2.data.classes; //add each class to the Classes collection if it doesnt exist already\n\n\t\t\t\t\tfor (course in meteorBabelHelpers.sanitizeForInObject(courses)) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tvar check = Classes.find({\n\t\t\t\t\t\t\t\t'classSub': courses[course].subject.toLowerCase(),\n\t\t\t\t\t\t\t\t'classNum': courses[course].catalogNbr\n\t\t\t\t\t\t\t}).fetch();\n\n\t\t\t\t\t\t\tif (check.length == 0) {\n\t\t\t\t\t\t\t\tconsole.log(\"new class: \" + courses[course].subject + \" \" + courses[course].catalogNbr + \",\" + semesters[semester]); //insert new class with empty prereqs and reviews\n\n\t\t\t\t\t\t\t\tClasses.insert({\n\t\t\t\t\t\t\t\t\tclassSub: courses[course].subject.toLowerCase(),\n\t\t\t\t\t\t\t\t\tclassNum: courses[course].catalogNbr,\n\t\t\t\t\t\t\t\t\tclassTitle: courses[course].titleLong,\n\t\t\t\t\t\t\t\t\tclassPrereq: [],\n\t\t\t\t\t\t\t\t\tclassFull: courses[course].subject.toLowerCase() + \" \" + courses[course].catalogNbr + \" \" + courses[course].titleLong.toLowerCase(),\n\t\t\t\t\t\t\t\t\tclassSems: [semesters[semester]]\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tvar matchedCourse = check[0]; //only 1 should exist\n\n\t\t\t\t\t\t\t\tvar oldSems = matchedCourse.classSems;\n\n\t\t\t\t\t\t\t\tif (oldSems.indexOf(semesters[semester]) == -1) {\n\t\t\t\t\t\t\t\t\tconsole.log(\"update class \" + courses[course].subject + \" \" + courses[course].catalogNbr + \",\" + semesters[semester]);\n\t\t\t\t\t\t\t\t\toldSems.push(semesters[semester]); //add this semester to the list\n\n\t\t\t\t\t\t\t\t\tClasses.update({\n\t\t\t\t\t\t\t\t\t\t_id: matchedCourse._id\n\t\t\t\t\t\t\t\t\t}, {\n\t\t\t\t\t\t\t\t\t\t$set: {\n\t\t\t\t\t\t\t\t\t\t\tclassSems: oldSems\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\t\tconsole.log(course);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n} //returns an array of the current semester, to be given to the addAllCourses function\n\n\nfunction findCurrSemester() {\n\tvar response = HTTP.call(\"GET\", \"https://classes.cornell.edu/api/2.0/config/rosters.json\", {\n\t\ttimeout: 30000\n\t});\n\n\tif (response.statusCode != 200) {\n\t\tconsole.log(\"error\");\n\t} else {\n\t\tresponse = JSON.parse(response.content);\n\t\tallSemesters = response.data.rosters;\n\t\tthisSem = allSemesters[allSemesters.length - 1].slug;\n\t\treturn [thisSem];\n\t}\n} //returns an array of all current semesters, to be given to the addAllCourses function\n\n\nfunction findAllSemesters() {\n\tvar response = HTTP.call(\"GET\", \"https://classes.cornell.edu/api/2.0/config/rosters.json\", {\n\t\ttimeout: 30000\n\t});\n\n\tif (response.statusCode != 200) {\n\t\tconsole.log(\"error\");\n\t} else {\n\t\tresponse = JSON.parse(response.content);\n\t\tallSemesters = response.data.rosters;\n\t\tvar allSemestersArray = allSemesters.map(function (semesterObject) {\n\t\t\treturn semesterObject.slug;\n\t\t});\n\t\tconsole.log(allSemestersArray);\n\t\treturn allSemestersArray;\n\t}\n}","map":{"version":3,"sources":["imports/api/classes.js"],"names":["module","export","Classes","Subjects","Reviews","Mongo","watch","require","v","HTTP","check","Collection","schema","SimpleSchema","_id","type","String","classSub","classNum","Number","classTitle","classAtten","classPrereq","optional","classFull","classSems","subShort","subFull","user","text","difficulty","quality","grade","date","Date","visible","Meteor","methods","insert","review","classId","diff","medGrade","undefined","regex","RegExp","test","makeVisible","update","$set","removeReview","remove","addNewSemester","initiate","isServer","addAllCourses","getCourseById","courseId","console","log","c","find","fetch","startup","_ensureIndex","publish","validClasses","searchString","limit","validReviews","visiblity","ret","semesters","semester","result","call","timeout","statusCode","response","JSON","parse","content","sub","data","subjects","course","parent","checkSub","value","toLowerCase","length","descr","result2","response2","courses","classes","subject","catalogNbr","titleLong","matchedCourse","oldSems","indexOf","push","error","findCurrSemester","allSemesters","rosters","thisSem","slug","findAllSemesters","allSemestersArray","map","semesterObject"],"mappings":"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","file":"imports/api/classes.js.map","sourcesContent":["import { Mongo } from 'meteor/mongo';\nimport { HTTP } from 'meteor/http';\nimport { check } from 'meteor/check';\n\nexport const Classes = new Mongo.Collection('classes');\nClasses.schema = new SimpleSchema({\n  _id: {type: String},\n  classSub: {type: String},\n  classNum: {type: Number},\n  classTitle: {type: String},\n  classAtten: {type: Number},\n  classPrereq : { type: [String] ,optional: true},\n  classFull: {type: String},\n  classSems: {type: [String]}\n});\n\nexport const Subjects = new Mongo.Collection('subjects');\nSubjects.schema = new SimpleSchema({\n\t_id: {type: String},\n\tsubShort : {type: String},\n\tsubFull: {type: String}\n});\n\nexport const Reviews = new Mongo.Collection('reviews');\nReviews.schema = new SimpleSchema({\n\t_id: {type: String},\n\tuser: {type: String},\n\ttext: {type: String,optional: true},\n\tdifficulty: {type: Number},\n\tquality: {type: Number},\n \tclass: {type: String}, //ref to classId\n \tgrade: {type: Number},\n \tdate: {type: Date},\n \tvisible: {type: Number}\n});\n\n// defines all methods that will be editing the database so that database changes occur only on the server\nMeteor.methods({\n\t//insert a new review into the reviews database\n\tinsert: function(review, classId) {\n\t\t//only insert if all necessary feilds are filled in\n\t\tif (review.text != null && review.diff != null && review.quality != null && review.medGrade != null && classId != undefined && classId != null) {\n\t\t\t//ensure there are no illegal characters\n\t\t\tvar regex = new RegExp(/^(?=.*[A-Z0-9])[\\w:;.,!()\"'\\/$ ]+$/i)\n\t\t\tif (regex.test(review.text)) {\n\t\t\t  \tReviews.insert({\n\t\t\t\t    text: review.text,\n\t\t\t\t    difficulty: review.diff,\n\t\t\t\t    quality: review.quality,\n\t\t\t\t    class: classId,\n\t\t\t\t    grade: review.medGrade,\n\t\t\t\t    date: new Date(),\n\t\t\t\t    visible: 0\n\t\t\t\t})\n\t\t\t\treturn 1 //success\n\t\t\t} else {\n\t\t\t\treturn 0 //fail\n\t\t\t}\n\t\t} else {\n\t\t\treturn 0 //fail\n\t\t}\n\t},\n\t//make the reveiw with this id visible, checking to make sure it has a real id\n\tmakeVisible: function (review) {\n\t\tvar regex = new RegExp(/^(?=.*[A-Z0-9])/i)\n\t\tif (regex.test(review._id)) {\n   \t\t\tReviews.update(review._id, {$set: { visible: 1} })\n   \t\t\treturn 1\n   \t\t} else {\n   \t\t\treturn 0\n   \t\t}\n \t},\n \t//remove the review with this id, checking to make sure the id is a real id\n \tremoveReview: function(review) {\n \t\tvar regex = new RegExp(/^(?=.*[A-Z0-9])/i)\n\t\tif (regex.test(review._id)) {\n   \t\tReviews.remove({ _id: review._id})\n   \t\treturn 1\n   \t} else {\n   \t\treturn 0\n   \t}\n\t},\n\t//update the database to add any new classes in the current semester if they don't already exist. To be called from the admin page once a semester.\n\taddNewSemester: function(initiate) {\n\t\tif (initiate && Meteor.isServer) {\n\t\t\t//return addAllCourses(findCurrSemester());\n\t\t\treturn addAllCourses(['FA15']);\n\t\t}\n  },\n  //get the course (as an object) with this id, checking to make sure the id is real\n  getCourseById: function(courseId) {\n    console.log(courseId);\n    var regex = new RegExp(/^(?=.*[A-Z0-9])/i)\n\n    if (regex.test(courseId)) {\n      var c = Classes.find({_id: courseId}).fetch()[0];\n      //console.log(c);\n   \t\treturn c;\n   \t}\n    return null\n  }\n});\n\n//Code that runs only on the server\nif (Meteor.isServer) {\n    Meteor.startup(() => { // code to run on server at startup\n\t  //add indexes to collections for faster search\n\t  Classes._ensureIndex(\n\t        { 'classSub' : 1 },\n\t        { 'classNum' : 1 },\n\t        { 'classTitle' : 1 },\n          { '_id' : 1}\n\t    );\n\t  Subjects._ensureIndex(\n\t  \t\t{ 'subShort' : 1 },\n\t        { 'subFull' : 1 }\n\t  \t);\n\t  Reviews._ensureIndex(\n\t    \t{ 'class' : 1},\n\t    \t{ 'difficulty' : 1 },\n\t    \t{ 'quality' : 1 },\n\t    \t{ 'grade' : 1 },\n\t    \t{ 'user' : 1 },\n\t    \t{ 'visible' : 1 }\n\t  \t);\n\t  });\n\n    //code that runs whenever needed\n    //\"publish\" classes based on search query. Only published classes are visible to the client\n    Meteor.publish('classes', function validClasses(searchString) {\n\t  \tif (searchString != undefined && searchString != \"\") {\n\t  \t\tconsole.log(\"query entered:\", searchString);\n\t  \t\treturn Classes.find({'$or' : [\n\t\t\t  { 'classSub':{ '$regex' : `.*${searchString}.*`, '$options' : '-i' }},\n\t\t\t  { 'classNum':{ '$regex' : `.*${searchString}.*`, '$options' : '-i' } },\n\t\t\t  { 'classTitle':{ '$regex' : `.*${searchString}.*`, '$options' : '-i' }},\n\t\t\t  { 'classFull':{ '$regex' : `.*${searchString}.*`, '$options' : '-i' }}]\n\n\t\t\t},\n\t\t\t{limit: 200});\n\t  \t}\n\t  \telse {\n        console.log(\"no search\");\n\t  \t\treturn Classes.find({},\n\t  \t\t{limit: 200});\n\t  \t}\n  \t});\n\n    //\"publish\" reviews based on selected course and visibility requirements. Only published reviews are visible to the client\n\tMeteor.publish('reviews', function validReviews(courseId, visiblity) {\n\t  \tvar ret = null\n\t  \t//show valid reviews for this course\n      console.log('getting reviews');\n\t  \tif (courseId != undefined && courseId != \"\" && visiblity == 1) {\n        console.log('in 1');\n\t  \t\tret =  Reviews.find({class : courseId, visible : 1}, {limit: 700});\n\t  \t} else if (courseId != undefined && courseId != \"\" && visiblity == 0) { //invalidated reviews for a class\n        console.log('in 2');\n        ret =  Reviews.find({class : courseId, visible : 0},\n\t\t\t{limit: 700});\n\t  \t} else if (visiblity == 0) { //all invalidated reviews\n\t  \t\tret =  Reviews.find({visible : 0}, {limit: 700});\n\t  \t} else { //no reviews\n\t  \t\t//will always be empty because visible is 0 or 1. allows meteor to still send the ready flag when a new publication is sent\n\t  \t\tret = Reviews.find({visible : 10});\n\t  \t}\n\t  \treturn ret\n  \t});\n\n  \t// COMMENT THESE OUT AFTER THE FIRST METEOR BUILD!!\n\t//Classes.remove({});\n\t//Subjects.remove({});\n\t//addAllCourses(findAllSemesters());\n}\n\n//Other helper functions used above\n\n// Adds all classes and subjects from Cornell's API between the selected semesters to the database.\n// Called when updating for a new semester and when initializing the database\nfunction addAllCourses(semesters) {\n    // var semesters = [\"SP17\", \"SP16\", \"SP15\",\"FA17\", \"FA16\", \"FA15\"];\n\tfor (semester in semesters) {\n\t\t//get all classes in this semester\n\t    var result = HTTP.call(\"GET\", \"https://classes.cornell.edu/api/2.0/config/subjects.json?roster=\" + semesters[semester], {timeout: 30000});\n\t    if (result.statusCode != 200) {\n\t      console.log(\"error\");\n\t    } else {\n\t\t  \tresponse = JSON.parse(result.content);\n\t\t  \t//console.log(response);\n\t\t\tvar sub = response.data.subjects;\n\t\t\tfor (course in sub) {\n\t\t\t    parent = sub[course];\n\t\t\t    //if subject doesn't exist add to Subjects collection\n\t\t\t    checkSub = Subjects.find({'subShort' : (parent.value).toLowerCase()}).fetch();\n\t\t\t    if (checkSub.length == 0) {\n\t\t\t     \tconsole.log(\"new subject: \" + parent.value);\n\t\t\t        Subjects.insert({\n\t\t\t        \tsubShort : (parent.value).toLowerCase(),\n\t\t\t        \tsubFull : parent.descr\n\t\t\t        });\n\t\t\t    }\n\n\t\t\t    //for each subject, get all classes in that subject for this semester\n\t\t\t    var result2 = HTTP.call(\"GET\", \"https://classes.cornell.edu/api/2.0/search/classes.json?roster=\" + semesters[semester] + \"&subject=\"+ parent.value, {timeout: 30000});\n\t\t\t    if (result2.statusCode != 200) {\n\t\t\t    \tconsole.log(\"error2\");\n\t\t\t    } else {\n\t\t\t    \tresponse2 = JSON.parse(result2.content);\n\t\t\t\t    courses = response2.data.classes;\n\n\t\t\t\t    //add each class to the Classes collection if it doesnt exist already\n\t\t\t\t    for (course in courses) {\n\t\t\t\t    \ttry {\n\t\t\t\t\t        var check = Classes.find({'classSub' : (courses[course].subject).toLowerCase(), 'classNum' : courses[course].catalogNbr}).fetch();\n\t\t\t\t\t        if (check.length == 0) {\n\t\t\t\t\t            console.log(\"new class: \" + courses[course].subject + \" \" + courses[course].catalogNbr + \",\" + semesters[semester]);\n\t\t\t\t\t        \t//insert new class with empty prereqs and reviews\n\t\t\t\t\t        \tClasses.insert({\n\t\t\t\t\t          \t\tclassSub : (courses[course].subject).toLowerCase(),\n\t\t\t\t\t          \t\tclassNum : courses[course].catalogNbr,\n\t\t\t\t\t          \t\tclassTitle : courses[course].titleLong,\n\t\t\t\t\t          \t\tclassPrereq : [],\n\t\t\t\t\t          \t\tclassFull: (courses[course].subject).toLowerCase() + \" \" + courses[course].catalogNbr +\" \" + courses[course].titleLong.toLowerCase(),\n\t\t\t\t\t          \t\tclassSems: [semesters[semester]]\n\t\t\t\t\t       \t\t});\n\t\t\t\t\t     \t} else {\n\t\t\t\t\t     \t\tvar matchedCourse = check[0] //only 1 should exist\n\t\t\t\t\t     \t\tvar oldSems = matchedCourse.classSems;\n\t\t\t\t\t        \tif (oldSems.indexOf(semesters[semester]) == -1) {\n\t\t\t\t\t        \t\tconsole.log(\"update class \" + courses[course].subject + \" \" + courses[course].catalogNbr + \",\" + semesters[semester]);\n\t\t\t\t\t\t        \toldSems.push(semesters[semester]) //add this semester to the list\n\t\t\t\t\t\t        \tClasses.update({_id: matchedCourse._id}, {$set: {classSems: oldSems}})\n\t\t\t\t\t\t        }\n\t\t\t\t\t      \t}\n\t\t\t\t\t    } catch(error){\n\t\t\t\t\t    \tconsole.log(course);\n\t\t\t\t\t    }\n\t\t\t\t    }\n\t\t\t    }\n\t\t\t}\n\t\t}\n\t}\n}\n\n//returns an array of the current semester, to be given to the addAllCourses function\nfunction findCurrSemester()  {\n\tvar response = HTTP.call(\"GET\", \"https://classes.cornell.edu/api/2.0/config/rosters.json\", {timeout: 30000});\n\tif (response.statusCode != 200) {\n      console.log(\"error\");\n    } else {\n\t  \tresponse = JSON.parse(response.content);\n\t\tallSemesters = response.data.rosters;\n\t\tthisSem = allSemesters[allSemesters.length - 1].slug;\n\t\treturn [thisSem];\n\t}\n}\n\n//returns an array of all current semesters, to be given to the addAllCourses function\nfunction findAllSemesters() {\n\tvar response = HTTP.call(\"GET\", \"https://classes.cornell.edu/api/2.0/config/rosters.json\", {timeout: 30000});\n\tif (response.statusCode != 200) {\n      console.log(\"error\");\n    } else {\n\t  \tresponse = JSON.parse(response.content);\n\t\tallSemesters = response.data.rosters;\n\t\tvar allSemestersArray = allSemesters.map(function(semesterObject) {\n\t\t\treturn semesterObject.slug;\n\t\t})\n\t\tconsole.log(allSemestersArray)\n\t\treturn allSemestersArray\n\t}\n}\n"]},"hash":"222fdfc13938d94146c24a939cea7fb473abf967"}
